{"version":3,"sources":["../src/index.ts","../utils/get-package-info.ts","../src/commands/init.ts","../src/utils/logger.ts"],"sourcesContent":["import { Command } from \"commander\";\r\nimport { getPackageInfo } from \"../utils/get-package-info\";\r\nimport { init } from \"./commands/init\";\r\n\r\nprocess.on(\"SIGINT\", () => process.exit(0));\r\nprocess.on(\"SIGTERM\", () => process.exit(0));\r\n\r\nasync function main() {\r\n  const packageInfo = await getPackageInfo();\r\n  const program = new Command()\r\n    .name(\"custom-gh-action\")\r\n    .description(\"create custom github action\")\r\n    .version(\r\n      packageInfo.version || \"1.0.0\",\r\n      \"-v, --version\",\r\n      \"display the version number\"\r\n    );\r\n\r\n   program.addCommand(init); \r\n   program.parse()\r\n}\r\n\r\nmain()\r\n","import path from \"path\"\r\nimport fs from \"fs-extra\"\r\nimport { type PackageJson } from \"type-fest\"\r\n\r\nexport function getPackageInfo() {\r\n  const packageJsonPath = path.join(\"package.json\")\r\n\r\n  return fs.readJSONSync(packageJsonPath) as PackageJson\r\n}\r\n","import { existsSync, promises as fs } from \"fs\";\r\nimport { Command } from \"commander\";\r\nimport path from \"path\";\r\nimport prompts from \"prompts\";\r\nimport { z } from \"zod\";\r\nimport { logger } from \"../utils/logger\";\r\nimport chalk from \"chalk\";\r\n\r\nconst initOptionsSchema = z.object({\r\n  cwd: z.string(),\r\n  yes: z.boolean(),\r\n  name: z.optional(z.string()),\r\n});\r\n\r\nexport const init = new Command()\r\n  .name(\"init\")\r\n  .description(\"initialize your project and install dependencies\")\r\n  .option(\"-y, --yes\", \"skip confirmation prompt.\", false)\r\n  .option(\r\n    \"-c, --cwd <cwd>\",\r\n    \"the working directory. defaults to the current directory.\",\r\n    process.cwd()\r\n  )\r\n  .option(\"-n, --name <name>\", \"the name of the github action.\", \"\")\r\n  .action(async (opts) => {\r\n    try {\r\n      const options = initOptionsSchema.parse(opts);\r\n      const cwd = path.resolve(options.cwd);\r\n\r\n      // Ensure target directory exists.\r\n      if (!existsSync(cwd)) {\r\n        logger.error(`The path ${cwd} does not exist. Please try again.`);\r\n        process.exit(1);\r\n      }\r\n\r\n      const config = await promptForConfig(cwd);\r\n\r\n\r\n      logger.info(\"\");\r\n      logger.info(\r\n        `${chalk.green(\r\n          \"Success!\"\r\n        )} Project initialization completed. You may now add components.`\r\n      );\r\n      logger.info(\"\");\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  });\r\n\r\nexport async function promptForConfig(cwd: string, skip = false) {\r\n  const highlight = (text: string) => chalk.cyan(text);\r\n\r\n  const custom_action = [\r\n    {\r\n      name: \"javascript\",\r\n      label: \"JavaScript\",\r\n    },\r\n    {\r\n      name: \"docker\",\r\n      label: \"Docker\",\r\n    },\r\n    {\r\n      name: \"composite\",\r\n      label: \"Composite\",\r\n    },\r\n  ];\r\n\r\n  const validateName = (name:string) => {\r\n    // Adjusted regular expression to allow underscores and hyphens\r\n    const isValid = /^[a-zA-Z0-9_-]+$/.test(name);\r\n\r\n    if (!isValid) {\r\n      console.log(\"Invalid name. The name must not contain special characters or spaces, except for underscores and hyphens.\");\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  const options = await prompts([\r\n    {\r\n      type: \"text\",\r\n      name: \"action_name\",\r\n      message: `What is the name of your action? `,\r\n      validate:(name:string) => validateName(name)\r\n    },\r\n    {\r\n      type: \"select\",\r\n      name: \"custom_action\",\r\n      message: `Which ${highlight(\"custom action\")} would you like to use?`,\r\n      choices: custom_action.map((custom_action) => ({\r\n        title: custom_action.label,\r\n        value: custom_action.name,\r\n      })),\r\n    },\r\n    {\r\n      type: (prev) => (prev === \"javascript\" ? \"toggle\" : null),\r\n      name: \"typescript\",\r\n      message: `Would you like to use ${highlight(\r\n        \"TypeScript\"\r\n      )} (recommended)?`,\r\n      initial: true,\r\n      active: \"yes\",\r\n      inactive: \"no\",\r\n    },\r\n  ]);\r\n\r\n  \r\n  if (!skip) {\r\n    const { proceed } = await prompts({\r\n      type: \"confirm\",\r\n      name: \"proceed\",\r\n      message: `Write configuration to ${highlight(\r\n        \"components.json\"\r\n      )}. Proceed?`,\r\n      initial: true,\r\n    })\r\n\r\n    if (!proceed) {\r\n      process.exit(0)\r\n    }\r\n  }\r\n\r\n  return options;\r\n}\r\n","import chalk from \"chalk\"\r\n\r\nexport const logger = {\r\n  error(...args: unknown[]) {\r\n    console.log(chalk.red(...args))\r\n  },\r\n  warn(...args: unknown[]) {\r\n    console.log(chalk.yellow(...args))\r\n  },\r\n  info(...args: unknown[]) {\r\n    console.log(chalk.cyan(...args))\r\n  },\r\n  success(...args: unknown[]) {\r\n    console.log(chalk.green(...args))\r\n  },\r\n  break() {\r\n    console.log(\"\")\r\n  },\r\n}\r\n"],"mappings":"AAAA,OAAS,WAAAA,MAAe,YCAxB,OAAOC,MAAU,OACjB,OAAOC,MAAQ,WAGR,SAASC,GAAiB,CAC/B,IAAMC,EAAkBH,EAAK,KAAK,cAAc,EAEhD,OAAOC,EAAG,aAAaE,CAAe,CACxC,CCRA,OAAS,cAAAC,MAAkC,KAC3C,OAAS,WAAAC,MAAe,YACxB,OAAOC,MAAU,OACjB,OAAOC,MAAa,UACpB,OAAS,KAAAC,MAAS,MCJlB,OAAOC,MAAW,QAEX,IAAMC,EAAS,CACpB,SAASC,EAAiB,CACxB,QAAQ,IAAIF,EAAM,IAAI,GAAGE,CAAI,CAAC,CAChC,EACA,QAAQA,EAAiB,CACvB,QAAQ,IAAIF,EAAM,OAAO,GAAGE,CAAI,CAAC,CACnC,EACA,QAAQA,EAAiB,CACvB,QAAQ,IAAIF,EAAM,KAAK,GAAGE,CAAI,CAAC,CACjC,EACA,WAAWA,EAAiB,CAC1B,QAAQ,IAAIF,EAAM,MAAM,GAAGE,CAAI,CAAC,CAClC,EACA,OAAQ,CACN,QAAQ,IAAI,EAAE,CAChB,CACF,EDZA,OAAOC,MAAW,QAElB,IAAMC,EAAoBC,EAAE,OAAO,CACjC,IAAKA,EAAE,OAAO,EACd,IAAKA,EAAE,QAAQ,EACf,KAAMA,EAAE,SAASA,EAAE,OAAO,CAAC,CAC7B,CAAC,EAEYC,EAAO,IAAIC,EAAQ,EAC7B,KAAK,MAAM,EACX,YAAY,kDAAkD,EAC9D,OAAO,YAAa,4BAA6B,EAAK,EACtD,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,oBAAqB,iCAAkC,EAAE,EAChE,OAAO,MAAOC,GAAS,CACtB,GAAI,CACF,IAAMC,EAAUL,EAAkB,MAAMI,CAAI,EACtCE,EAAMC,EAAK,QAAQF,EAAQ,GAAG,EAG/BG,EAAWF,CAAG,IACjBG,EAAO,MAAM,YAAYH,CAAG,oCAAoC,EAChE,QAAQ,KAAK,CAAC,GAGhB,IAAMI,EAAS,MAAMC,EAAgBL,CAAG,EAGxCG,EAAO,KAAK,EAAE,EACdA,EAAO,KACL,GAAGV,EAAM,MACP,UACF,CAAC,gEACH,EACAU,EAAO,KAAK,EAAE,CAChB,OAASG,EAAO,CACd,QAAQ,IAAIA,CAAK,CACnB,CACF,CAAC,EAEH,eAAsBD,EAAgBL,EAAaO,EAAO,GAAO,CAC/D,IAAMC,EAAaC,GAAiBhB,EAAM,KAAKgB,CAAI,EAE7CC,EAAgB,CACpB,CACE,KAAM,aACN,MAAO,YACT,EACA,CACE,KAAM,SACN,MAAO,QACT,EACA,CACE,KAAM,YACN,MAAO,WACT,CACF,EAEMC,EAAgBC,GAEJ,mBAAmB,KAAKA,CAAI,EAOrC,IAJL,QAAQ,IAAI,2GAA2G,EAChH,IAMLb,EAAU,MAAMc,EAAQ,CAC5B,CACE,KAAM,OACN,KAAM,cACN,QAAS,oCACT,SAAUD,GAAgBD,EAAaC,CAAI,CAC7C,EACA,CACE,KAAM,SACN,KAAM,gBACN,QAAS,SAASJ,EAAU,eAAe,CAAC,0BAC5C,QAASE,EAAc,IAAKA,IAAmB,CAC7C,MAAOA,EAAc,MACrB,MAAOA,EAAc,IACvB,EAAE,CACJ,EACA,CACE,KAAOI,GAAUA,IAAS,aAAe,SAAW,KACpD,KAAM,aACN,QAAS,yBAAyBN,EAChC,YACF,CAAC,kBACD,QAAS,GACT,OAAQ,MACR,SAAU,IACZ,CACF,CAAC,EAGD,GAAI,CAACD,EAAM,CACT,GAAM,CAAE,QAAAQ,CAAQ,EAAI,MAAMF,EAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS,0BAA0BL,EACjC,iBACF,CAAC,aACD,QAAS,EACX,CAAC,EAEIO,GACH,QAAQ,KAAK,CAAC,CAElB,CAEA,OAAOhB,CACT,CFzHA,QAAQ,GAAG,SAAU,IAAM,QAAQ,KAAK,CAAC,CAAC,EAC1C,QAAQ,GAAG,UAAW,IAAM,QAAQ,KAAK,CAAC,CAAC,EAE3C,eAAeiB,GAAO,CACpB,IAAMC,EAAc,MAAMC,EAAe,EACnCC,EAAU,IAAIC,EAAQ,EACzB,KAAK,kBAAkB,EACvB,YAAY,6BAA6B,EACzC,QACCH,EAAY,SAAW,QACvB,gBACA,4BACF,EAEDE,EAAQ,WAAWE,CAAI,EACvBF,EAAQ,MAAM,CACjB,CAEAH,EAAK","names":["Command","path","fs","getPackageInfo","packageJsonPath","existsSync","Command","path","prompts","z","chalk","logger","args","chalk","initOptionsSchema","z","init","Command","opts","options","cwd","path","existsSync","logger","config","promptForConfig","error","skip","highlight","text","custom_action","validateName","name","prompts","prev","proceed","main","packageInfo","getPackageInfo","program","Command","init"]}